<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Painel do Inquilino</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <script src="js/firebase.js"></script>
</head>
<body class="bg-light">

<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center">
    <h4>Seus Dados</h4>
    <button id="logout" class="btn btn-danger btn-sm">Sair</button>
  </div>
  <hr>

  <div id="dadosInquilino" class="mb-4"></div>

  <button id="btnPix" class="btn btn-success mb-4">Gerar Pix</button>

  <h5>Histórico de Pagamentos</h5>
  <ul id="listaPagamentos" class="list-group"></ul>
</div>

<script>
  const cpf = localStorage.getItem("cpf");
  if (!cpf) window.location.href = "index.html";

  db.ref("inquilinos/" + cpf).once("value").then(snapshot => {
    const data = snapshot.val();
    if (!data) return alert("Inquilino não encontrado.");

    const total = (Number(data.aluguel) + Number(data.agua)).toFixed(2);
    document.getElementById("dadosInquilino").innerHTML = `
      <p><strong>Nome:</strong> ${data.nome}</p>
      <p><strong>Endereço:</strong> ${data.endereco}</p>
      <p><strong>Aluguel:</strong> R$${data.aluguel}</p>
      <p><strong>Água:</strong> R$${data.agua}</p>
      <p><strong>Total do mês:</strong> R$${total}</p>
    `;

    // Lista pagamentos
    const lista = document.getElementById("listaPagamentos");
    if (data.pagamentos) {
      Object.keys(data.pagamentos).reverse().forEach(mes => {
        const p = data.pagamentos[mes];
        const li = document.createElement("li");
        li.classList.add("list-group-item");
        li.textContent = `${mes} - R$${p.valor} - ${p.forma} (${p.data})`;
        lista.appendChild(li);
      });
    }
  });

  document.getElementById("btnPix").addEventListener("click", () => {
    const chavePix = "seuemail@banco.com";
    const valor = 150; // pode puxar do banco
    const descricao = `Aluguel ${cpf}`;
    const linkPix = `https://pix.me/${chavePix}?amount=${valor}&message=${encodeURIComponent(descricao)}`;
    window.open(linkPix, "_blank");
  });

  document.getElementById("logout").addEventListener("click", () => {
    auth.signOut().then(() => {
      localStorage.removeItem("cpf");
      window.location.href = "index.html";
    });
  });
</script>
</body>
</html>
